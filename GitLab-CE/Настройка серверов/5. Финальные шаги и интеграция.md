### CI/CD пайплайн в действии

После завершения установки и регистрации GitLab Runner, был создан кастомный `.gitlab-ci.yml`, описывающий 3 этапа:

- `test`: установка зависимостей и запуск `pytest`
    
- `docker-test`: сборка и тестирование Docker-образа
    
- `deploy`: деплой на сервер через SSH
    
#### Используемые технологии:

- **Python 3.12**
    
- **Docker**
    
- **pytest**
    
- **Alpine Linux для деплоя**
    
- **SSH с ключом из переменной `$VDS_KEY`**
    

### Структура `.gitlab-ci.yml`

`stages:   - test   - docker-test   - deploy`

Каждый этап отделён логически, с кэшированием `pip`-пакетов и проверкой работы приложения через `curl` внутри отдельного контейнера.

Главный фикс: использование `>` для многострочных shell-команд, чтобы YAML не ломался.

---

### Секреты и переменные

В GitLab добавлены следующие переменные:

- `VDS_HOST` — IP или доменное имя сервера деплоя
    
- `VDS_USER` — пользователь для подключения по SSH
    
- `VDS_KEY` — приватный SSH-ключ (вставлен как переменная CI/CD)
    

---

### Тестовый деплой

На машине `Deploy-UB` настроено приложение:

- Клонирован репозиторий
    
- Прописан `deploy.sh` с командами перезапуска сервиса или перезапуска Docker-контейнера
    
- Проверено, что пайплайн выполняется от начала до конца
    

---

### Файлы проекта:

- `flask_app/` — исходный код приложения Flask
    
- `Dockerfile` — билд-образ
    
- `deploy.sh` — сценарий деплоя
    
- `.gitlab-ci.yml` — CI/CD пайплайн
    
- `requirements.txt` — зависимости
    

---

### Итог: CI/CD инфраструктура готова

Проект теперь:

- Автоматически запускает тесты
    
- Собирает Docker-образ
    
- Проверяет, что он работает
    
- Загружает его на целевой сервер